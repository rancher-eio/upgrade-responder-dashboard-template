{
  "__inputs": [
    {
      "name": "DS_UPGRADE-CHECKER-INFLUXDB",
      "label": "upgrade-checker-influxDB",
      "type": "datasource",
      "pluginId": "influxdb"
    },
    {
      "name": "VAR_APPNAME",
      "type": "constant",
      "label": "AppName",
      "value": "VAR_APPNAME"
    }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "description": "The dashboard for the Upgrade Responder project",
  "editable": true,
  "gnetId": 14429,
  "panels": [
    {
      "gridPos": { "h": 3, "w": 24, "x": 0, "y": 0 },
      "id": 16,
      "options": {
        "content": "The metrics we're showing here are collected using ${AppName} Upgrade Responder Service, which will notify the user when a new release of ${AppName} is available.\n\nThe source code is available at https://github.com/longhorn/upgrade-responder .",
        "mode": "markdown"
      },
      "title": "$AppName Public Metrics Dashboard",
      "type": "text"
    },
    {
      "id": 18,
      "type": "geomap",
      "title": "Active Node Map",
      "datasource": "${DS_UPGRADE-CHECKER-INFLUXDB}",
      "gridPos": { "h": 9, "w": 12, "x": 0, "y": 3 },
      "options": {
        "layers": [
          {
            "config": {
              "showLegend": true,
              "style": {
                "color": { "field": "total" },
                "opacity": 0.8,
                "size": { "field": "total", "max": 30, "min": 2 },
                "symbol": { "fixed": "img/icons/marker/circle.svg", "mode": "fixed" }
              }
            },
            "location": { "lookup": "country_isocode", "mode": "lookup" },
            "name": "Layer 1",
            "tooltip": true,
            "type": "markers"
          }
        ],
        "view": { "id": "zero", "lat": 0, "lon": 0, "zoom": 1 }
      },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "custom": { "hideFrom": { "legend": false, "tooltip": false, "viz": false } },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "rgba(245, 54, 54, 0.9)", "value": null },
              { "color": "rgba(237, 129, 40, 0.89)", "value": 0 },
              { "color": "rgba(50, 172, 45, 0.97)", "value": 10 }
            ]
          }
        }
      },
      "targets": [
        {
          "alias": "$tag_country_isocode",
          "groupBy": [ { "params": [ "country_isocode" ], "type": "tag" } ],
          "measurement": "by_country_code_down_sampling",
          "orderByTime": "ASC",
          "query": "SELECT last(\"total\") FROM \"by_country_code_down_sampling\" WHERE $timeFilter GROUP BY \"country_isocode\"",
          "rawQuery": true,
          "refId": "A",
          "resultFormat": "table",
          "select": [
            [ { "params": [ "total" ], "type": "field" }, { "params": [], "type": "last" } ]
          ]
        }
      ]
    },
    {
      "id": 4,
      "type": "timeseries",
      "title": "Active Node Count",
      "datasource": "${DS_UPGRADE-CHECKER-INFLUXDB}",
      "gridPos": { "h": 9, "w": 12, "x": 12, "y": 3 },
      "options": {
        "legend": { "displayMode": "list", "placement": "bottom" },
        "tooltip": { "mode": "single" }
      },
      "targets": [
        {
          "alias": "Total",
          "groupBy": [ { "params": [ "1h" ], "type": "time" }, { "params": [ "null" ], "type": "fill" } ],
          "measurement": "upgrade_request_down_sampling",
          "query": "SELECT last(\"total\") FROM \"upgrade_request_down_sampling\" WHERE $timeFilter GROUP BY time(1h) fill(null)",
          "rawQuery": false,
          "refId": "A",
          "resultFormat": "time_series"
        }
      ]
    },
    {
      "id": 12,
      "type": "timeseries",
      "title": "Active Node By $AppName Versions",
      "datasource": "${DS_UPGRADE-CHECKER-INFLUXDB}",
      "gridPos": { "h": 9, "w": 12, "x": 0, "y": 12 },
      "options": {
        "legend": { "displayMode": "list", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "fieldConfig": { "defaults": { "custom": { "stacking": { "group": "A", "mode": "normal" } } } },
      "targets": [
        {
          "alias": "$tag_app_version",
          "groupBy": [ { "params": [ "1h" ], "type": "time" }, { "params": [ "app_version" ], "type": "tag" }, { "params": [ "null" ], "type": "fill" } ],
          "measurement": "by_app_version_down_sampling",
          "query": "SELECT last(\"total\") FROM \"by_app_version_down_sampling\" WHERE $timeFilter GROUP BY time(1h), \"app_version\" fill(null)",
          "rawQuery": false,
          "refId": "A",
          "resultFormat": "time_series"
        }
      ]
    }
  ],
  "schemaVersion": 38,
  "templating": {
    "list": [
      {
        "current": { "text": "${VAR_APPNAME}", "value": "${VAR_APPNAME}" },
        "hide": 2,
        "name": "AppName",
        "query": "${VAR_APPNAME}",
        "type": "constant"
      }
    ]
  },
  "time": { "from": "now-30d", "to": "now" },
  "title": "Upgrade Responder",
  "uid": "tsrvoC-mz"
}
